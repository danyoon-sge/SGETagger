#!/usr/bin/env ruby

require 'optparse'
require 'methadone'
require 'sge_tagger'

class App
  include Methadone::Main
  include Methadone::CLILogging
  include Methadone::SH
  include SGETagger

  main do |file_dir|
    tagger = Tagger.new(options)

    Tagger.taggable_files(file_dir).each do |rfile|
      tagger.tag_file(rfile)
    end

    output_summary(tagger)
  end

  # supplemental methods
  def self.output_summary(tagger)
    info "#{tagger.new_count} newly tagged files"
    info "#{tagger.prev_count} previously tagged files"
    info "#{tagger.ignored_count} 3rd party files ignored"
  end

  # Declare command-line interface here

  description "Tag SGE owned files with legal info"

  # Accept flags
  on("-c", "--chatty", "Log messages to standard output")

  # Require an argument
  arg :file_dir, "Directory containing files to tag with legal info"

  # # Make an argument optional
  # arg :optional_arg, :optional

  version SGETagger::VERSION

  use_log_level_option

  go!
end
